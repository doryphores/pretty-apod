fs = require 'fs'
{parser, uglify} = require 'uglify-js'

task 'build', 'Concatenate and minify javascript assets', ->
	console.log "Combining and minifying JS assets..."
	manifestFile = fs.readFileSync "manifest.json", "utf-8"
	files = JSON.parse manifestFile
	combined = ''

	for file in files
		combined += fs.readFileSync file

	ast = parser.parse combined
	minified = uglify.gen_code uglify.ast_squeeze uglify.ast_mangle ast, extra: yes

	fs.writeFileSync "production/combined.js", minified, "utf-8"

	console.log "All done"
